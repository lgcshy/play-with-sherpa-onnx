# 语音助手唤醒词配置说明

## 当前唤醒词

语音助手系统当前配置了以下唤醒词：

1. **你好小立** - 主要唤醒词
   - Boosting Score: 2.0 (较高，容易触发)
   - Trigger Threshold: 0.4 (中等阈值)

2. **小立小立** - 次要唤醒词
   - Boosting Score: 1.5 (中等)
   - Trigger Threshold: 0.3 (较低阈值，更容易触发)

3. **小立同学** - 备用唤醒词
   - Boosting Score: 1.8 (较高)
   - Trigger Threshold: 0.35 (中等阈值)

## 唤醒词参数说明

根据[sherpa-onnx官方文档](https://k2-fsa.github.io/sherpa/onnx/kws/index.html)：

### Boosting Score (提升分数)
- **作用**: 帮助包含关键词的路径在beam search中存活
- **范围**: 建议 1.0-3.0
- **效果**: 数值越大，对应的关键词越容易被触发
- **示例**: `:2.0` 表示提升分数为2.0

### Trigger Threshold (触发阈值)
- **作用**: 定义可触发解码序列的最小声学概率
- **范围**: 0.0-1.0
- **效果**: 数值越小，对应的关键词越容易被触发
- **示例**: `#0.4` 表示触发阈值为0.4

## 使用方法

### 1. Web界面使用
1. 访问 `http://192.168.73.130:8000`
2. 点击"连接"按钮
3. 点击"开始录音"按钮
4. 说出任意一个唤醒词：
   - "你好小立"
   - "小立小立"
   - "小立同学"

### 2. 自定义唤醒词

要添加新的唤醒词，修改 `backend/config.py` 文件：

```python
CUSTOM_KEYWORDS = [
    "你好小立 :2.0 #0.4",      # 主要唤醒词
    "小立小立 :1.5 #0.3",      # 次要唤醒词
    "小立同学 :1.8 #0.35",     # 备用唤醒词
    "你的新词 :1.2 #0.5"       # 新增唤醒词
]
```

### 3. 参数调优建议

#### 提高触发率（更容易被唤醒）
- 增加 Boosting Score: `:2.5` 或 `:3.0`
- 降低 Trigger Threshold: `#0.2` 或 `#0.3`

#### 降低误触发（减少误唤醒）
- 降低 Boosting Score: `:1.0` 或 `:1.2`
- 提高 Trigger Threshold: `#0.6` 或 `#0.7`

#### 平衡配置
- Boosting Score: `:1.5-2.0`
- Trigger Threshold: `#0.3-0.5`

## 技术实现

### 音素转换
系统使用 `pypinyin` 库将中文唤醒词转换为音素格式：

```
你好小立 → n ǐ h ǎo x iǎo l ì
小立小立 → x iǎo l ì x iǎo l ì
小立同学 → x iǎo l ì t óng x ué
```

### 关键词文件格式
生成的关键词文件 (`custom_keywords.txt`) 格式：

```
n ǐ h ǎo x iǎo l ì :2.0 #0.4 @你好小立
x iǎo l ì x iǎo l ì :1.5 #0.3 @小立小立
x iǎo l ì t óng x ué :1.8 #0.35 @小立同学
```

## 测试建议

1. **环境测试**: 在安静环境中测试基本功能
2. **噪声测试**: 在有一定背景噪声的环境中测试
3. **距离测试**: 在不同距离下测试唤醒效果
4. **口音测试**: 用不同的语调和口音测试

## 故障排除

### 唤醒词不被识别
1. 检查音频质量（16kHz, 单声道）
2. 降低 Trigger Threshold
3. 增加 Boosting Score
4. 检查关键词文件格式

### 误触发过多
1. 提高 Trigger Threshold
2. 降低 Boosting Score
3. 检查环境噪声
4. 调整VAD参数

### 性能问题
1. 检查模型加载状态
2. 监控CPU使用率
3. 调整音频块大小
4. 优化并发处理
